<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Member Booking Pass</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .card { border: 1px solid #ccc; padding: 16px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>My Booking</h1>
  <div id="bookingCard">Loading your booking details...</div>

  <script>
    $(function () {
        function getParameterByName(name) {
            const url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
            const results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        const customerId = getParameterByName('userid');
const hash = getParameterByName('hash');

// Added logging
console.log("Page loaded");
console.log("Full URL:", window.location.href);
console.log("Extracted customerId:", customerId);
console.log("Extracted hash:", hash);

if (!customerId || !hash) {
    $('#bookingCard').html("Missing parameters.");
    return;
}


        // Call Render backend API
        fetch(`https://pass-cafe-gardens-backend-final.onrender.com/api/get-bookings?userid=${customerId}&hash=${hash}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    $('#bookingCard').html("Error: " + data.error);
                    return;
                }

                if (data.bookings.length === 0) {
                    $('#bookingCard').html("No live bookings.");
                    return;
                }

                const booking = data.bookings[0];
                $('#bookingCard').html(`
                    <div class="card">
                        <h3>Your Current Booking</h3>
                        <p><strong>Resource:</strong> ${booking.Resource.Name}</p>
                        <p><strong>Start:</strong> ${new Date(booking.FromTime).toLocaleString()}</p>
                        <p><strong>End:</strong> ${new Date(booking.ToTime).toLocaleString()}</p>
                    </div>
                `);
            })
            .catch(err => {
                console.error(err);
                $('#bookingCard').html("Error loading bookings.");
            });
    });
  </script>
</body>
</html>
